import numpy as np
import matplotlib.pyplot as plt
from scipy.optimize import curve_fit

timing = [
    (14, 34.837),
    (14, 34.517),
    (14, 34.473),
    (14, 34.73),
    (14, 34.419),
    (1, 408.259),
    (1, 406.325),
    (1, 406.265),
    (1, 407.545),
    (1, 406.01),
    (8, 60.804),
    (8, 60.761),
    (8, 60.778),
    (8, 60.61),
    (8, 60.734),
    (12, 40.582),
    (12, 40.217),
    (12, 40.204),
    (12, 40.442),
    (12, 40.152),
    (2, 208.765),
    (2, 205.781),
    (2, 205.556),
    (2, 209.875),
    (2, 204.74099999999999),
    (7, 68.049),
    (7, 68.544),
    (7, 68.72),
    (7, 67.283),
    (7, 68.432),
    (18, 27.216),
    (18, 27.596),
    (18, 27.685),
    (18, 27.634),
    (18, 27.666),
    (11, 44.778),
    (11, 45.381),
    (11, 44.773),
    (11, 44.745),
    (11, 44.828),
    (22, 22.661),
    (22, 22.963),
    (22, 22.556),
    (22, 23.137),
    (22, 22.817),
    (20, 24.913),
    (20, 24.696),
    (20, 24.556),
    (20, 24.847),
    (20, 24.74),
    (23, 21.525),
    (23, 21.603),
    (23, 21.727),
    (23, 21.475),
    (23, 21.73),
    (21, 23.846),
    (21, 23.646),
    (21, 23.409),
    (21, 23.633),
    (21, 23.883),
    (16, 31.303),
    (16, 31.252),
    (16, 31.188),
    (16, 30.971),
    (16, 31.061),
    (3, 145.459),
    (3, 149.564),
    (3, 146.289),
    (3, 146.522),
    (3, 147.722),
    (24, 20.679),
    (24, 20.591),
    (24, 20.531),
    (24, 20.703),
    (24, 20.72),
    (4, 115.191),
    (4, 111.80799999999999),
    (4, 114.021),
    (4, 114.032),
    (4, 113.18),
    (15, 33.078),
    (15, 34.159),
    (15, 33.007),
    (15, 34.144),
    (15, 33.373),
    (6, 79.98),
    (6, 80.497),
    (6, 80.607),
    (6, 79.774),
    (6, 76.36),
    (13, 37.904),
    (13, 37.509),
    (13, 37.62),
    (13, 37.94),
    (13, 38.573),
    (19, 26.29),
    (19, 25.87),
    (19, 25.746),
    (19, 26.557),
    (19, 26.027),
    (10, 48.932),
    (10, 48.74),
    (10, 48.565),
    (10, 49.154),
    (10, 49.529),
    (5, 94.571),
    (5, 94.595),
    (5, 94.402),
    (5, 94.037),
    (5, 93.932),
    (9, 54.021),
    (9, 53.55),
    (9, 53.452),
    (9, 53.692),
    (9, 53.674),
    (17, 29.215),
    (17, 28.862),
    (17, 28.697),
    (17, 28.719),
    (17, 28.759),
]


def main():
    infos = {}
    info = {}

    for u, t in timing:
        if u not in infos:
            infos[u] = []
        infos[u].append(t)

    for u, v in infos.items():
        info[u] = sum(v) / len(v)

    xdata = np.array(sorted(info.keys()))
    ydata = np.array([info[k] for k in xdata])

    def amdahl(p, f):
        return info[1] * f + (1 - f) * info[1] / p

    [f], _ = curve_fit(amdahl, xdata, ydata)
    plt.scatter(xdata, ydata, c='b', label='data')
    plt.scatter(xdata, amdahl(xdata, f), c='r', label='fit: f=%5.3f' % f)
    plt.grid()
    plt.xlabel('threads')
    plt.ylabel('time')
    plt.legend()
    plt.show()


if __name__ == '__main__':
    main()
