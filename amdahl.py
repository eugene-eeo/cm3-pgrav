import numpy as np
import matplotlib.pyplot as plt
from scipy.optimize import curve_fit


def main():
    # info = dict([
    #     (1, 10.29),
    #     (2, 10.37),
    #     (3, 7.481999999999999),
    #     (4, 6.406000000000001),
    #     (5, 7.31),
    #     (6, 6.388),
    #     (7, 5.52),
    #     (8, 5.13),
    # ])

    info = dict([
        (1,  484.148),
        (2,  413.454),
        (3,  300.497),
        (4,  232.508),
        (5,  205.018),
        (6,  177.419),
        (7,  148.943),
        (8,  134.783),
        (9,  126.738),
        (10, 106.897),
        (11, 106.375),
        (12, 102.971),
        (13, 97.904),
        (14, 93.534),
        (15, 88.925),
        (16, 82.798),
        (17, 83.709),
        (18, 73.559),
        (19, 77.113),
        (20, 69.938),
        (21, 73.186),
        (22, 70.207),
        (23, 70.298),
        (24, 71.297),
    ])

    # info = dict([
    #     (1, 1174.404),
    #     (2, 987.32),
    #     (3, 686.407),
    #     (4, 546.425),
    #     (5, 449.944),
    #     (6, 367.979),
    #     (7, 324.215),
    #     (8, 286.389),
    #     (9, 251.335),
    #     (10, 230.707),
    #     (11, 208.613),
    #     (12, 192.707),
    #     (13, 174.492),
    #     (14, 166.106),
    #     (15, 154.112),
    #     (16, 144.04500000000002),
    #     (17, 135.626),
    #     (18, 127.444),
    #     (19, 121.1),
    #     (20, 116.87299999999999),
    #     (21, 110.077),
    #     (22, 106.094),
    #     (23, 99.178),
    #     (24, 94.999),
    # ])

    speedup = {}
    for k in info:
        speedup[k] = info[1] / info[k]

    xdata = np.array(sorted(speedup.keys()))
    ydata = np.array([speedup[k] for k in xdata])

    def amdahl(p, f):
        return 1 / (f + (1 - f) / p)

    [f], _ = curve_fit(amdahl, xdata, ydata)
    plt.scatter(xdata, ydata, c='b', label='data')
    plt.scatter(xdata, amdahl(xdata, f), c='r', label='fit: f=%5.3f' % f)
    plt.grid()
    plt.xlabel('cores')
    plt.ylabel('speedup')
    plt.legend()
    plt.show()


if __name__ == '__main__':
    main()
