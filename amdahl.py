import numpy as np
import matplotlib.pyplot as plt
from scipy.optimize import curve_fit

timing = [
    (1, 89.35900000000001),
    (2, 45.954),
    (2, 45.877),
    (3, 32.669),
    (3, 32.036),
    (3, 32.108),
    (4, 25.154),
    (4, 24.604),
    (4, 24.339),
    (4, 23.574),
    (5, 21.154),
    (5, 21.388),
    (5, 20.787),
    (5, 21.109),
    (5, 21.067),
    (6, 17.769),
    (6, 17.487),
    (6, 17.793),
    (6, 18.375),
    (6, 17.668),
    (6, 18.182),
    (7, 15.478),
    (7, 15.13),
    (7, 15.367),
    (7, 15.438),
    (7, 15.424),
    (7, 15.105),
    (7, 15.606),
    (8, 13.641),
    (8, 13.871),
    (8, 13.51),
    (8, 13.044),
    (8, 13.502),
    (8, 13.954),
    (8, 13.957),
    (8, 13.913),
    (9, 12.153),
    (9, 12.448),
    (9, 12.385),
    (9, 12.337),
    (9, 12.206),
    (9, 12.305),
    (9, 12.45),
    (9, 12.108),
    (9, 12.759),
    (10, 10.951),
    (10, 10.82),
    (10, 10.816),
    (10, 10.874),
    (10, 10.916),
    (10, 10.815),
    (10, 10.816),
    (10, 10.856),
    (10, 10.791),
    (10, 10.893),
    (11, 10.135),
    (11, 9.925),
    (11, 10.033),
    (11, 10.114),
    (11, 9.939),
    (11, 10.125),
    (11, 9.941),
    (11, 10.505),
    (11, 10.165),
    (11, 10.437),
    (11, 10.053),
    (12, 9.52),
    (12, 9.127),
    (12, 9.196),
    (12, 9.105),
    (12, 9.398),
    (12, 9.319),
    (12, 9.089),
    (12, 9.255),
    (12, 9.096),
    (12, 9.099),
    (12, 9.147),
    (12, 9.089),
    (13, 8.87),
    (13, 8.82),
    (13, 8.83),
    (13, 8.646),
    (13, 8.636),
    (13, 8.957),
    (13, 8.755),
    (13, 8.64),
    (13, 8.752),
    (13, 8.685),
    (13, 8.732),
    (13, 8.897),
    (13, 8.515),
    (14, 8.45),
    (14, 7.901),
    (14, 8.078),
    (14, 8.301),
    (14, 8.312),
    (14, 7.955),
    (14, 7.882),
    (14, 7.969),
    (14, 7.899),
    (14, 8.289),
    (14, 7.888),
    (14, 7.882),
    (14, 7.893),
    (14, 8.095),
    (15, 7.599),
    (15, 7.491),
    (15, 7.637),
    (15, 7.484),
    (15, 7.475),
    (15, 7.535),
    (15, 7.489),
    (15, 7.634),
    (15, 7.54),
    (15, 7.486),
    (15, 7.474),
    (15, 7.532),
    (15, 7.481),
    (15, 7.681),
    (15, 7.527),
    (16, 7.455),
    (16, 7.062),
    (16, 7.208),
    (16, 7.125),
    (16, 7.238),
    (16, 7.213),
    (16, 7.358),
    (16, 7.057),
    (16, 7.179),
    (16, 7.408),
    (16, 7.102),
    (16, 7.041),
    (16, 7.145),
    (16, 7.238),
    (16, 7.149),
    (16, 7.302),
    (17, 6.882),
    (17, 6.665),
    (17, 6.833),
    (17, 6.839),
    (17, 6.667),
    (17, 6.858),
    (17, 6.692),
    (17, 6.75),
    (17, 7.017),
    (17, 6.962),
    (17, 6.853),
    (17, 6.669),
    (17, 6.68),
    (17, 6.68),
    (17, 6.663),
    (17, 6.797),
    (17, 6.917),
    (18, 6.373),
    (18, 6.365),
    (18, 6.358),
    (18, 6.372),
    (18, 6.349),
    (18, 6.432),
    (18, 6.368),
    (18, 6.358),
    (18, 6.28),
    (18, 6.271),
    (18, 6.5),
    (18, 6.447),
    (18, 6.362),
    (18, 6.377),
    (18, 6.555),
    (18, 6.356),
    (18, 6.356),
    (18, 6.354),
    (19, 6.117),
    (19, 6.067),
    (19, 6.205),
    (19, 6.052),
    (19, 6.003),
    (19, 6.013),
    (19, 6.022),
    (19, 6.018),
    (19, 6.233),
    (19, 6.154),
    (19, 6.02),
    (19, 6.013),
    (19, 6.097),
    (19, 6.148),
    (19, 6.009),
    (19, 6.014),
    (19, 6.109),
    (19, 6.275),
    (19, 6.077),
    (20, 5.991),
    (20, 5.835),
    (20, 6.01),
    (20, 5.914),
    (20, 5.978),
    (20, 6.043),
    (20, 5.842),
    (20, 5.883),
    (20, 5.861),
    (20, 5.98),
    (20, 5.982),
    (20, 5.864),
    (20, 5.826),
    (20, 6.07),
    (20, 5.978),
    (20, 5.978),
    (20, 5.857),
    (20, 5.827),
    (20, 5.881),
    (20, 5.929),
    (21, 5.566),
    (21, 5.65),
    (21, 5.532),
    (21, 5.548),
    (21, 5.46),
    (21, 5.536),
    (21, 5.543),
    (21, 5.53),
    (21, 5.535),
    (21, 5.54),
    (21, 5.547),
    (21, 5.45),
    (21, 5.462),
    (21, 5.459),
    (21, 5.534),
    (21, 5.549),
    (21, 5.542),
    (21, 5.534),
    (21, 5.55),
    (21, 5.556),
    (21, 5.541),
    (22, 5.375),
    (22, 5.338),
    (22, 5.553),
    (22, 5.325),
    (22, 5.419),
    (22, 5.286),
    (22, 5.427),
    (22, 5.439),
    (22, 5.562),
    (22, 5.364),
    (22, 5.338),
    (22, 5.327),
    (22, 5.359),
    (22, 5.375),
    (22, 5.441),
    (22, 5.274),
    (22, 5.353),
    (22, 5.399),
    (22, 5.338),
    (22, 5.411),
    (22, 5.351),
    (22, 5.278),
    (23, 5.139),
    (23, 5.083),
    (23, 5.151),
    (23, 5.038),
    (23, 5.019),
    (23, 5.095),
    (23, 5.082),
    (23, 5.025),
    (23, 5.05),
    (23, 5.091),
    (23, 5.203),
    (23, 5.038),
    (23, 5.092),
    (23, 5.038),
    (23, 5.297),
    (23, 5.027),
    (23, 5.272),
    (23, 5.036),
    (23, 5.085),
    (23, 5.136),
    (23, 5.295),
    (23, 5.083),
    (23, 5.089),
    (24, 5.587),
    (24, 4.966),
    (24, 4.964),
    (24, 4.941),
    (24, 4.941),
    (24, 5.264),
    (24, 4.957),
    (24, 4.979),
    (24, 4.956),
    (24, 4.948),
    (24, 4.954),
    (24, 4.983),
    (24, 4.96),
    (24, 4.948),
    (24, 5.04),
    (24, 4.936),
    (24, 4.91),
    (24, 4.974),
    (24, 4.937),
    (24, 4.91),
    (24, 5.002),
    (24, 4.921),
    (24, 4.922),
    (24, 4.895),
]


def main():
    infos = {}
    info = {}

    for u, t in timing:
        if u not in infos:
            infos[u] = []
        infos[u].append(t)

    for u, v in infos.items():
        info[u] = sum(v) / len(v)

    speedup = {}
    for k in info:
        speedup[k] = info[1] / info[k]

    xdata = np.array(sorted(speedup.keys()))
    ydata = np.array([speedup[k] for k in xdata])

    def amdahl(p, f):
        return 1 / (f + (1 - f) / p)

    [f], _ = curve_fit(amdahl, xdata, ydata)
    plt.scatter(xdata, ydata, c='b', label='data')
    plt.scatter(xdata, amdahl(xdata, f), c='r', label='fit: f=%5.3f' % f)
    plt.grid()
    plt.xlabel('cores')
    plt.ylabel('speedup')
    plt.legend()
    plt.show()


if __name__ == '__main__':
    main()
